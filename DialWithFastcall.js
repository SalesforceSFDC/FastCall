{!REQUIRESCRIPT('/resource/FastCall__C2C/vendor/jquery.js')}
{!REQUIRESCRIPT('/resource/FastCall__C2C/vendor/jquery-ui.js')}
{!REQUIRESCRIPT('/soap/ajax/34.0/connection.js')}
{!REQUIRESCRIPT("/soap/ajax/34.0/apex.js")}
function buildNamespace(e){var a="";
returnFastCall_List.isPackageContext&&FastCall_List.packageNamespace&&FastCall_List.packageNamespace.length>0&&(a=FastCall_List.packageNamespace+(e?".":"__")),a}function getSettingsAndResolveNamespace(){var e=null;try{FastCall_List.packageNamespace="FastCall",FastCall_List.isPackageContext=!0,e=sforce.apex.execute(buildNamespace(!0)+"FastCallSoftPhoneAPI","getDialFromListSettings",{})}catch(a){a.faultstring.indexOf("No service available for class")>-1?(FastCall_List.packageNamespace="",FastCall_List.isPackageContext=!1,e=sforce.apex.execute(buildNamespace(!0)+"FastCallSoftPhoneAPI","getDialFromListSettings",{})):alert(a)}return e}function checkListDialEnabled(){var e="";if(void 0===FastCall_List.dialSettings){var a=getSettingsAndResolveNamespace();FastCall_List.dialSettings=JSON.parse(a)}return"true"!==FastCall_List.dialSettings.dialFromListCapability?e='<p style="padding:10px;">Dial by list is an advanced feature in FastCall that enables users to dial down a list one record after another. The user has the option to stay in a call as FastCall dials each record in succession. Or FastCall can initiate a call to the user for each outbound call to the Salesforce record. Records are dialed one at a time. When the user ends the current call, the next record is dialed. Users select records in Salesforce using a standard list view. List views can be filtered or you can use a Salesforce campaign. A custom button must be added to the page as explained <a href="http://fastcall.com/products/dial-by-list/" target="_blank">here.</a></p>':"true"!==FastCall_List.dialSettings.dialFromListEnabled&&(e='<p style="padding:10px;">Dial by list is disabled by the Admin.</p>'),e}function fcDialList(){var e=[],a="";"Lead"===FastCall_List.sObjectApiName&&(e.push("Company"),a=","+e.join(","));var l=sforce.connection.query("SELECT Id,Name,"+phoneFieldsToQuery()+a+" FROM "+FastCall_List.sObjectApiName+" WHERE Id IN "+FastCall_List.recordIdsForQuery),t=l.getArray("records"),i=[],s={};$j.each(t,function(e,a){var l=getPhoneNnumberToDial(a);null!==l&&(a.dialPhoneNumber=l,s[a.Id.substring(0,15)]=a)}),$j.each(FastCall_List.recordIds,function(e,a){s[a]&&i.push(s[a])}),console.log("Records to dial btn:"+JSON.stringify(t)),sendCTIMessage("/CLICK_TO_DIAL?DIAL_LIST=true&DN="+encodeURIComponent(JSON.stringify(i))+"&ENTITY_NAME=FastCallDialList&OBJECT_NAME="+($j("#fc-user-stay-conf").prop("checked")?"confmode":"single_call"))}function phoneFieldsToQuery(){var e=[];return $j("#fc-try-other-fields").prop("checked")?$j.each(phoneFields,function(a,l){e.push(l.name)}):e.push($j("#fc-select-phone-field").val()),e.join(",")}function getPhoneNnumberToDial(e){var a=null;if(null===e[$j("#fc-select-phone-field").val()]&&$j("#fc-try-other-fields").prop("checked"))for(var l=0;null===a&&l<phoneFields.length;)null!==e[phoneFields[l].name]&&(a=e[phoneFields[l].name]),l++;else null!==e[$j("#fc-select-phone-field").val()]&&(a=e[$j("#fc-select-phone-field").val()]);return a}var $j=jQuery.noConflict();FastCall_List={},FastCall_List.packageTaintClass="CallController",FastCall_List.dial=function(e,a){if(FastCall_List.sObjectApiName=e,0===a.length)alert("You must select any record before start dialing.");else{var l=checkListDialEnabled();if(0===l.length){FastCall_List.recordIds=a,FastCall_List.recordIdsForQuery="('",FastCall_List.recordIdsForQuery+=a.join("','")+"')";var t=[];sforce.connection.describeSObject(e).fields.forEach(function(e,a){"phone"===e.type&&t.push({name:e.name,label:e.label})}),l+='<div class="modal-fieldset"><label class="label-small">Phone field to dial</label><select id="fc-select-phone-field">',$j.each(t,function(e,a){l+='<option value="'+a.name+'">'+a.label+"</option>"}),l+="</select></div><br/>",l+='<div class="modal-fieldset"><label class="label-big">Dial other Phone fields if selected field is empty</label><input id="fc-try-other-fields" type="checkbox"/></div>',l+='<div class="modal-fieldset"><label class="label-big">Keep me on line between calls</label><input id="fc-user-stay-conf" type="checkbox"/></div>',l+='<div id="fc-list-dial-modal-alert" class="alert-box warning radius">Please note that if you don\'t stay online between calls, the FastCall softphone is preferred.<br/>Depending on the phone devices, there might be some glitches on the overall experience. See <a href="#">here</a></div>'}if(0===$j("#dialog").length){var i='<div id="dialog" class="fc-dial-dialog" title="FastCall dial by list"></div>',s=".fc-dial-dialog .modal-fieldset {margin: 10px 0px 0px 0px;} .fc-dial-dialog .label-small {display: inline-block;width: 200px;} .fc-dial-dialog #fc-select-phone-field {width: 244px;} .fc-dial-dialog .label-big {display: inline-block; width: 432px;} .fc-dial-dialog {width: 454px !important;} .ui-dialog {width:480px !important; z-index:10000 !important;} .alert-box {margin-top:10px; border-style:solid; border-width: 1px;display: none;font-size: 0.8125rem;font-weight: normal;margin-bottom: 1.25rem;padding: 0.875rem 1.5rem 0.875rem 0.875rem;position: relative;transition: opacity 300ms ease-out;background-color:#2ba6cb;border-color: #258faf;color:#FFFFFF;} .alert-box.radius {border-radius: 3px; }.alert-box.warning {background-color:#f08a24;border-color:#de770f;color:#FFFFFF;}.alert-box.info {background-color: #a0d3e8;border-color: #74bfdd;color: #4f4f4f;}";$j("head").append('<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/redmond/jquery-ui.min.css" type="text/css"/>').append("<style>"+s+"</style>"),$j("body").append(i)}var o={};"true"===FastCall_List.dialSettings.dialFromListCapability&&"true"===FastCall_List.dialSettings.dialFromListEnabled?o.Start=function(){fcDialList(),$j(this).dialog("close")}:"true"!==FastCall_List.dialSettings.dialFromListCapability?o.Upgrade=function(){window.open("http://fastcall.com/pricing/"),$j(this).dialog("close")}:"true"!==FastCall_List.dialSettings.dialFromListEnabled&&(o.Accept=function(){$j(this).dialog("close")}),$j("#dialog").empty().append(l).dialog({autoOpen:!0,modal:!0,buttons:o}),$j("#fc-user-stay-conf").length>0&&($j("#fc-user-stay-conf").prop("checked",!0),$j("#fc-user-stay-conf").click(function(){$j(this).prop("checked")?$j("#fc-list-dial-modal-alert").hide():$j("#fc-list-dial-modal-alert").show()}))}};
/*Init_List_Dial*/
FastCall_List.dial('Contact', {!GETRECORDIDS($ObjectType.Contact)});
